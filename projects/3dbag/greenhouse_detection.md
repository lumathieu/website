---
layout: page
title: Detection and filtering of glass roofs for a more efficient 3DBAG reconstruction pipeline
permalink: /projects/3dbag/greenhouse_detection
---

<div class="row">
  <div class="col-sm-12 col-xs-12">
  <figure>
    <img class="img-responsive" src="{{ "img/greenhouses1.png" }}">
    <figcaption style="font-style:italic;font-size:smaller"> Figure 1:  a) AHN3 ground (green) and building (building) classes b) Heightfield c) Reconstruction result 
    </figcaption>
  </figure>
  </div>
</div>

- - -

* Table of Content
{:toc}

- - -


## Problem Description

The 3DBAG is an open dataset containing 3D building models from across the Netherlands at multiple levels of detail (LoD). These models are generated by combining data from two open datasets; the building footprints from the BAG and the aerial lidar data from the AHN. However, the reliance on these external datasets introduces a vulnerability to  the pipeline, since any quality inconsistency in the input data can significantly affect both the quality of  the output and the robustness of the reconstruction. One such challenge arises with the occurrence of glass surfaces in the lidar data, which are most commonly observed in the roofs of greenhouses. Due to the transparency of the glass, the point clouds of  structures with glass roofs are characterised by  the simultaneous capture of ground points and roof points within the structure’s footprint. (Fig.1.a)

The effect of these cases in the 3DBAG pipeline is two-fold. Firstly, the reconstructions from such lidar data are erroneous and can introduce non-existing, overcomplicated structures to the output dataset (Fig.1.c & 2). Secondly, the reconstruction of such cases takes significantly longer than the usual buildings due to the added complexity; as a result the whole reconstruction pipeline is hindered. Up until now, in order to avoid such problematic reconstructions in the  3DBAG output, we use the  “greenhouse & warehouse” (“kas & warenhuis”) classification from TOP10NL in order to exclude these buildings from the regular pipeline and reconstruct them, instead, at 1.2 level of detail.  However, using this TOP10NL class for identifying greenhouses is not very efficient since it is not complete; a lot of greenhouses are missing and other types of glass roofs are also not included. Moreover, warehouses, which don't pose the same reconstruction challenges, are treated like greenhouses and only achieve a Level of Detail (LoD) of 1.2. 

To tackle such cases and remove the dependency on the TOP10NL class, we have developed a simple, effective solution to correctly identify glass roofs using the point clouds and the building footprints. 

<div class="row">
  <div class="col-sm-12 col-xs-12">
    <figure>
    <img class="img-responsive" src="{{ "img/greenhouses2.png" }}" style="width:80%">
    <figcaption style="font-style:italic;font-size:smaller">Figure 2. Left: Footprint of a greenhouse, Right: problematic reconstruction due to the effect of the glass roof
    </figcaption>
  </figure>
  </div>
</div>


## Solution

As mentioned before, the glass roofs are characterized by the simultaneous existance of ground points and roof points within the structure’s footprint (Fig.3). Based on this characteristic, we utilize the AHN point cloud classes to divide the points into “ground” and “non-ground” and then we study the distribution of the points in 2D. Since different regions of the building footprint might present different distribution of points, we take advantage of the way te Classification Tree algorithms are designed and we classify each region as  “normal”, where most of the points belong to a single class, or as “mixed” where the cell under examination presents a mixture of both classes. As a high-level explanation, a Tree Classification algorithm selects from a whole dataset, which value of which variable better splits the data in two groups. For each group iteratively does the same, until a certain finishing condition is achieved. This process when performed only using two variables, looks like the example in the image below (Fig.4).

We chose to employ Random Forest classification, which works as an ensemble of multiple tree models using different subsets of the same data. Part of the predictive power of this method in comparison with simple regression trees is lost when only using only two features, but the small differences provided by very similar individual tree models will emphasize the least certain regions, such as walls, where different Regression Trees disagree on its classification.  
 

<div class="row">
  <div class="col-sm-12 col-xs-12">
      <figure>
    <img class="img-responsive" src="{{ "img/normal.png" }}" style="width:50%;float:left">
    <img class="img-responsive" src="{{ "img/mixed.png" }}" style="width:50%;float:left">
    <figcaption style="font-style:italic;font-size:smaller">Figure 3: Top view of the pointclouds of two buildings where the ground points are shown in red and non-ground points are shown in blue. Left: The building displays distinct regions of ground and non-ground (roof) points, Right: The building exhibits a blend of ground and non-ground points, indicative of a glass roof.
    </figcaption>
  </figure>
  </div>
</div>

---
<div class="row">
  <div class="col-sm-12 col-xs-12">
    <figure> 
    <img class="img-responsive" src="{{ "img/decision_tree.png" }}" style="width:70%">
    <figcaption style="font-style:italic;font-size:smaller">Figure 4: A Decision tree with 2 variables and its representation in a 2D plane.
    </figcaption>
  </figure>
  </div>
</div>

- - -


Because of the way that Random Forest classification divides the space in cells, we need to pre-process our data in order to align them as much as possible with the axes of the 2D space. After the pointcloud and footprints are rotated, a Random Forest model is trained for each building. The output is a heatmap of the probabilities of the building being "normal" or "mixed" (and thus containing a glass roof). Considering the mean and median values of the whole area within the building footprint we can subsequently categorize each building as "normal" or as "conatining glass-roof" (Fig.5).


<div class="row">
  <div class="col-sm-12 col-xs-12">
      <figure>
    <img class="img-responsive" src="{{ "img/greenhouses3.png" }}" style="width:80%">
    <figcaption style="font-style:italic;font-size:smaller">Figure 5: Left: Scatter plot of ground and non-ground points, Right: Probability that the grid-cell is "normal" vs "glass-roof". The results indicate that the roof is divided in two parts; one concrete and one glass. 
    </figcaption>
  </figure>
  </div>
</div>




## Results
We tested our method with a subset of 150 buildings with area above 100sqrm; 50 greenhouses from TOP10NL (with the warehouses removed) and 100 without the greenhouse label from the same region. 

To visualise how our method performs, we chose to apply it to a subset of the 3DBAG; we chose a region near Poeldijk which is characterised by the large number of greenhouses.  As shown in Figure 7, our method succeeds in detecting multiple building with glass-roofs which were not classified by TOP10NL. 

<div class="row">
  <div class="col-sm-12 col-xs-12">
    <figure style="border-top:0;border:0">
    <div>
    <img class="img-responsive" src="{{ "img/rusthovenlaan_0.jpg" }}" style="width:33%;float:left">
    <img class="img-responsive" src="{{ "img/rusthovenlaan_1.png" }}" style="width:33%;float:left">
    <img class="img-responsive" src="{{ "img/rusthovenlaan_2.jpg" }}" style="width:33%">
    </div>
    <figcaption style="font-style:italic;font-size:smaller;padding:5px"> Figure 6: Detected Greenhouse: Left: the pointcloud, Middle: building footprint, Right: aerial photo of the greenhouse. 
    </figcaption>
  </figure>
  </div>
</div>

---

<div class="row">
  <div class="col-sm-12 col-xs-12">
      <figure>
    <img class="img-responsive" src="{{ "img/ROI.jpg" }}" style="width:80%">
    <figcaption style="font-style:italic;font-size:smaller"> Figure 7: Blue: Greenhouses and Warehouses from TOP10NL, Red: Detected Glass Roofs by our method. 
    </figcaption>
  </figure>
  </div>
</div>

